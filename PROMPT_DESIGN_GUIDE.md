# PotPlayer AI字幕翻译 - 提示词设计指南

## 📚 概述

这份文档详细说明了插件中的提示词系统设计，包括设计理念、优化方案和具体实现。

---

## 🎯 核心设计理念

### 1. **三层架构**
```
Layer 1: Base Prompt (通用翻译指导)
   ↓
Layer 2: Language Guide (语言特定指导)
   ↓
Layer 3: Genre Guide (内容类型指导)
```

### 2. **优先级原则**
- **自然表达 > 字面意思 > 完整**
- **情感真实性 > 准确性**
- **听众体验 > 翻译技巧**

### 3. **质量第一原则**
每次输出前必须通过5项质量检查

---

## 🔧 系统组件详解

### **Component 1: BuildEnhancedPrompt()**
核心提示词生成函数，整合了所有维度的指导。

#### 输入参数
```angelscript
Text              // 待翻译文本
SrcLang           // 源语言代码 (en, ja, ko, fr 等)
DstLang           // 目标语言代码
contextLen        // 上下文条数 (影响提示词深度)
```

#### 输出结构
```
1. Core Mandate (核心使命)
   ↓
2. Subtitle Constraints (字幕特定约束)
   ↓
3. Translation Decision Tree (决策树)
   ↓
4. Language-Specific Guides (语言指导)
   ↓
5. Genre-Specific Guides (内容类型指导)
   ↓
6. Context Strategy (上下文策略)
   ↓
7. Quality Checks (质量检查)
```

---

## 🌍 语言特定指导详解

### **英语 (English)**

#### 三大类习语

| 类别 | 特征 | 例子 | 中文 |
|------|------|------|------|
| **动物习语** | 绝不是字面意思 | break a leg | 祝你好运 |
|  |  | wolf down | 狼吞虎咽 |
|  |  | fish out of water | 格格不入 |
| **身体部位** | 绝不是字面意思 | blow your mind | 震撼 |
|  |  | cost arm and leg | 非常贵 |
|  |  | get on someone's nerves | 惹恼 |
| **情感俚语** | 现代表达 | lit | 太棒了 |
|  |  | salty | 心烦 |
|  |  | flex | 炫耀 |

#### 处理规则
```
IF phrase contains animals/body parts
  → 100% 是习语，绝不字面翻译
ELSE IF phrase doesn't make literal sense
  → 很可能是习语，需要深层理解
ELSE IF has 'like X' pattern
  → 通常是比喻/习语，不是字面比较
```

---

### **日语 (Japanese)**

#### 四个优先级

| 优先级 | 内容 | 例子 |
|--------|------|------|
| **1. 情感真实性** | 比字面含义更重要 | 过度表达 → 匹配能量 |
| **2. 角色声线** | 可爱角色 ≠ 酷角色 | 小女孩用"啦/呀" vs 大哥用"的" |
| **3. 敬语体系** | 翻译为正式度，不字面 | -san → 正式 / -chan → 亲密 |
| **4. 一致性** | 相同角色一致的说话方式 | 同一人物术语保持一致 |

#### 敬语映射表
```
-san    → 正式、尊重
-sama   → 非常正式、敬畏
-chan   → 亲密、可爱、非正式
-kun    → 亲密、略微非正式
无后缀  → 非常亲密或粗鲁
```

#### 现代日语俚语
```
草(wara)   = 笑死了 / 哈哈
やばい     = 糟了 / 太棒了 (上下文决定)
推し       = 最爱 / 心头好
ウケる     = 超搞笑 / 笑死
マジで     = 真的假的 / 认真吗
```

---

### **韩语 (Korean)**

#### 敬语严格等级 ⚠️
```
-님        敬语对待，使用敬词
-어요      友好、正式但亲切
-어/-아    亲密、朋友般
-냐/-니    直接、粗鲁或非常亲密
```

#### K-文化词汇
```
뭐하는 거야? → 你在干什么呢? (温柔版)
미워        → 讨厌你 (常带玩笑性质)
사랑해      → 我爱你 (戏剧化表达)
오빠        → 翻译为角色/关系，不字面
```

---

### **法语 (French)**

#### 核心特点
- **Tu/Vous 区分** → 非常重要的正式度标志
- **浪漫气质** → 保留诗意和优雅
- **精致表达** → 找到相应的高雅中文

---

## 🎬 内容类型指导详解

### **动漫 (Anime)**

```
优先级顺序:
1. 情感真实性 > 字面准确
2. 角色声线一致
3. 能量匹配
4. 术语一致性

关键指标:
✓ 可爱角色音调软化 (啦/呀)
✓ 强气角色音调有力 (的/呢)
✓ 激情场景能量提升 (绝对/一定)
✓ 冷静场景降低能量 (吧/呢)
```

### **美漫 (Western Comic)**

```
优先级顺序:
1. 幽默和讽刺落地感
2. 行动词汇动态性
3. 自信和力量感
4. 流行文化一致

关键点:
✓ 笑点必须在中文版有效
✓ 单行笑话必须简洁有力
✓ 行动词要有冲击力
✓ 保留原始引用，解释遗失的笑点
```

### **科幻 (Sci-Fi)**

```
优先级顺序:
1. 技术术语精确和一致
2. 世界设定清晰
3. 学习者理解度
4. 概念命名易记

关键术语映射:
Engine     → 引擎(科技) / 马达(机械)
System     → 系统(复杂) / 装置(一般)
Network    → 网络 / 节点
Data       → 数据
Shader     → 着色器
```

### **剧情 (Drama)**

```
优先级顺序:
1. 情感细致入微
2. 对话真实性
3. 人物关系动态
4. 未言的含义

关键技巧:
✓ 字幕外的含义要显现
✓ 自然的中断和重复
✓ 距离感/亲密感通过词汇表现
✓ 短句表现停顿和沉默
```

### **恐怖 (Horror)**

```
优先级顺序:
1. 氛围和恐怖感
2. 节奏紧张度
3. 尖叫质量
4. 威胁真实性

关键点:
✓ 词汇选择建立气氛
✓ 短句式实现紧张感
✓ 尖叫用原始、有力的词
✓ 威胁要让人觉得真实
```

### **迪士尼 (Disney)**

```
优先级顺序:
1. 温暖和魔幻感
2. 情感真实性
3. 语言可理解度
4. 音乐节奏性

关键点:
✓ 词汇选择安全温暖
✓ 不回避真实情感，但要安慰感
✓ 简单清晰的词汇
✓ 韵律和流畅性对儿童内容重要
```

### **游戏开发 (GameDev)**

```
优先级顺序:
1. 技术准确和一致
2. 学习者可理解
3. 教学清晰度
4. 建立术语标准

关键术语标准化:
Component  → 组件(Unity) / 模块(一般)
Prefab     → 预制体
Scene      → 场景
Animation  → 动画 / 关键帧动画
Shader     → 着色器
Collider   → 碰撞器
Transform  → 变换
Material   → 材质
```

---

## ✅ 五步质量检查

每个翻译必须通过这5项检查：

### **检查1: 自然性 (Naturalness)**
```
问题: 本地说话者在看视频时会这样说吗?
失败 → 调整直到自然
通过 → 继续
```

### **检查2: 意思保留 (Meaning Preservation)**
```
问题: 翻译是否捕捉原始意图和感觉?
完全匹配 → 继续
部分匹配 → 修改
完全不同 → 重新翻译
```

### **检查3: 长度适当 (Length Appropriateness)**
```
问题: 这个长度对字幕显示合适吗?
太短(丢失意思) → 稍微展开
太长(无法读) → 精简
适当 → 继续
```

### **检查4: 语调匹配 (Tone Match)**
```
问题: 语调是否匹配角色和上下文?
完美匹配 → 继续
略微不对 → 调整情感语调
完全错误 → 重新翻译
```

### **检查5: 术语一致性 (Consistency)**
```
问题: 是否使用了一致的术语?
是 → 输出翻译
否 → 更新为匹配之前的术语
```

---

## 🔄 上下文策略

### **何时使用上下文**
- ✅ 同一说话者 → 保持一致的声线
- ✅ 同一话题 → 保持术语一致
- ✅ 同一场景 → 保持情感连贯性

### **何时忽略上下文**
- ❌ 不同说话者/话题 → 独立翻译
- ❌ 上下文与当前意思矛盾 → 忽略

---

## 📊 提示词效果优化建议

### **提示词长度 vs 质量**
```
短提示词    → 快速但质量不稳定
中等提示词  → 平衡 (当前实现)
长提示词    → 高质量但可能过度分析
```

**推荐**: 当前长度是经过优化的最佳平衡

### **温度参数 (Temperature)**
```
当前: 0.3 (低创意性，高确定性)
推荐范围: 0.2-0.5
- 0.1-0.2  → 极度保守，可能过于字面
- 0.3-0.5  → 平衡，推荐
- 0.6-1.0  → 高创意，可能不够准确
```

### **Token 限制**
```
当前: max_tokens=1000
足够 ✓ 覆盖：
- 简单字幕 (50-200 tokens)
- 复杂对话 (200-500 tokens)
- 最长字幕 (500-800 tokens)
```

---

## 🚀 进阶优化方向

### **1. 动态上下文调整**
```
IF 复杂的代词指代检测到
  g_maxHistory = 提高 1-2 条
ELSE IF 重复内容
  g_maxHistory = 降低 1 条
```

### **2. 双语种优化**
```
某些语言对需要特殊处理：
- 英→中: 习语密集 → 增加习语提示
- 日→中: 敬语复杂 → 增加敬语指导
- 韩→中: 文化差异 → 增加文化背景
```

### **3. 反馈循环**
```
IF 翻译质量低
  保存该对话到日志
  下次出现→自动增加上下文
```

### **4. 术语库维护**
```
FOR 每个内容类型
  维护专业术语表
  定期验证和更新
```

---

## 📝 使用示例

### **例1: 英文动漫**
```
源文本: "Breaking my heart right now!"
决策树:
1. 字面 → "现在破碎我的心" (不自然)
2. 习语检测 → "break" = 习语信号
3. 习语翻译 → "你现在要气死我了！"
4. 自然性检查 → ✓ 自然
5. 一致性检查 → ✓ 与角色声线匹配
输出: "你现在要气死我了!"
```

### **例2: 日语科幻**
```
源文本: "システムがダウンしました"
决策树:
1. 字面 → "系统down了"
2. 科幻术语 → "系统" (标准术语)
3. 完整表达 → "系统已宕机" 或 "系统崩溃了"
4. 自然性检查 → ✓
5. 术语一致性 → ✓
输出: "系统已宕机"
```

### **例3: 韩语剧情**
```
源文本: "미워" (from close female friend)
决策树:
1. 字面 → "讨厌你"
2. 文化检测 → 韩语/K-drama, 亲密关系
3. 敬语检查 → 非正式末尾 → 亲密
4. 上下文 → 朋友之间的拌嘴
5. 真实翻译 → "真是讨厌你" (带玩笑感) 或 "你真烦"
输出: "你真烦" (保留玩笑感)
```

---

## 🎓 最佳实践总结

| 做 ✅ | 不做 ❌ |
|-------|--------|
| 优先自然性 | 过度保守的字面翻译 |
| 匹配角色声线 | 所有角色使用相同风格 |
| 提取习语含义 | 硬翻习语 |
| 保留文化背景 | 完全本地化失去原意 |
| 多维度质量检查 | 仅检查准确性 |
| 上下文平衡使用 | 过度依赖或完全忽视 |
| 一致的术语 | 术语波动 |
| 字幕简洁 | 过长无法阅读 |

---

## 🔄 持续改进

### **反馈机制**
```
用户体验 → 翻译质量数据 → 提示词优化 → 输出改进
```

### **定期评估检查表**
- [ ] 习语识别准确率是否提高?
- [ ] 角色声线一致性是否改善?
- [ ] 用户反馈情感满意度?
- [ ] 翻译速度是否在可接受范围?
- [ ] 上下文使用是否恰当?

---

**文档版本**: 1.0  
**最后更新**: 2026年1月  
**维护者**: AI Assistant
